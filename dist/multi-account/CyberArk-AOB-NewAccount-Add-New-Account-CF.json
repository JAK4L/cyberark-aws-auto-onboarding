{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Resources": {
		"ElasticityLambdaTrustPolicy": {
			"Type": "AWS::IAM::ManagedPolicy",
			"Properties": {
				"Description" : "CyberArk Auto On Boarding Policy for Elasticity Lambda in Main Account to assume",
				"PolicyDocument" : {
					"Version": "2012-10-17",
					"Statement": [
						{
							"Action": [
								"ec2:DescribeInstances",
								"ec2:DescribeNetworkInterfaces",
								"ec2:DescribeVpcs",
								"ec2:DescribeVpcAttribute",
								"ec2:DescribeImages",
							    "ec2:GetPasswordData"
							],
							"Resource": "*",
							"Effect": "Allow"
						}
					]
				},
			"Roles": [ {
               "Ref": "AssumeRoleForElasticityLambdaInMainAccount"
            } ]
			}
		},
		"AssumeRoleForElasticityLambdaInMainAccount":
		{
			"Type": "AWS::IAM::Role",
			"Properties": {
				"RoleName": "CyberArk-AOB-AssumeRoleForElasticityLambda",
				"AssumeRolePolicyDocument": {
					"Statement": [
						{
							"Effect": "Allow",
							"Action": "sts:AssumeRole",
							"Principal":
							{
								"AWS": {
								"Fn::Join":
								[
									"",
									[
										"arn:aws:iam::",
										{
										"Ref": "MainAccountID"
										},
										":role/CyberArk-AOB-ElasticityLambdaRole"
									]
								]
							}
							}

						}
					]
				}
			}
		}
	},
	"Description": "",
	"Parameters": {
		"MainAccountID": {
            "Type": "String",
            "Description": "The ID of the Main Account"
        }
	},
	"Conditions": {

	},
	"Metadata": {
		"AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
					"Label": {
						"default": "General parameters"
					},
                    "Parameters": [
						"MainAccountID"
                    ]
                }
            ],
            "ParameterLabels": {
                "MainAccountID": {
                    "default": "Main Account ID"
                }
        }
	}
	},
	"Mappings": {

	}
}
